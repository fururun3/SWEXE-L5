<% if session[:login_uid] %>

  <h3>ツイート一覧</h3>

  <% @tweets.each do |e| %>
    <p>
      <%= e.message %>
      （いいね数：<%= e.likes.count %>）

      <% if e.user && e.user.uid == session[:login_uid] %>
        <%= link_to '削除', tweet_path(e),
              data: { turbo_method: :delete, turbo_confirm: "本当に削除しますか？" } %>
      <% end %>

      <% user = User.find_by(uid: session[:login_uid]) %>
      <% if user && !user.like_tweets.include?(e) %>
        <%= link_to 'いいね', likes_path(tweet_id: e.id),
              data: { turbo_method: :post } %>
      <% else %>
        <%= link_to 'いいね解除', like_path(e),
              data: { turbo_method: :delete } %>
      <% end %>
    </p>
  <% end %>

  <hr>

  <%= link_to "新規追加", new_tweet_path %><br>
  <%= link_to "プロフィール一覧を見る", profiles_path %><br>
  <%= link_to "ログアウト", top_logout_path %><br>

  <p>ログイン中UID：<%= session[:login_uid] %></p>

<% else %>
  <p>ログインしていません。</p>
  <%= link_to "ログイン", top_main_path %>
<% end %>
